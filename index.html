<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>êµ­ê°€ìœ ì‚° ê²€ìƒ‰ ì„œë¹„ìŠ¤</title>
    <style>
        body { font-family: 'Pretendard', sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background-color: #f9f9f9; }
        h1 { text-align: center; color: #333; margin-bottom: 30px; }
        
        /* ê²€ìƒ‰ì°½ ìŠ¤íƒ€ì¼ */
        .search-box { display: flex; gap: 10px; margin-bottom: 30px; }
        input { flex: 1; padding: 15px; font-size: 16px; border: 1px solid #ddd; border-radius: 8px; outline: none; transition: 0.3s; }
        input:focus { border-color: #2c3e50; box-shadow: 0 0 5px rgba(44, 62, 80, 0.2); }
        button { padding: 15px 30px; font-size: 16px; background-color: #2c3e50; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        button:hover { background-color: #34495e; }

        /* ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
        #result-area { display: flex; flex-direction: column; gap: 15px; }
        .item { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); cursor: pointer; transition: 0.2s; border: 1px solid #eee; }
        .item:hover { transform: translateY(-3px); box-shadow: 0 6px 16px rgba(0,0,0,0.1); border-color: #2c3e50; }
        .item-title { font-size: 1.3em; font-weight: bold; color: #2c3e50; margin-bottom: 8px; }
        .item-info { font-size: 0.95em; color: #7f8c8d; }

        /* ìƒì„¸ ì •ë³´ ìŠ¤íƒ€ì¼ */
        .detail-view { margin-top: 20px; padding-top: 20px; border-top: 2px dashed #eee; display: none; animation: fadeIn 0.5s; }
        .detail-img { max-width: 100%; border-radius: 8px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .detail-desc { line-height: 1.7; color: #444; word-break: keep-all; }
        
        .loading { text-align: center; color: #888; padding: 20px; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <h1>ğŸ›ï¸ êµ­ê°€ìœ ì‚° ìƒì„¸ ê²€ìƒ‰</h1>
    
    <div class="search-box">
        <input type="text" id="searchInput" placeholder="ë¬¸í™”ìœ ì‚° ì´ë¦„ ì…ë ¥ (ì˜ˆ: ê²½ë³µê¶, ì²¨ì„±ëŒ€, ìˆ­ë¡€ë¬¸)" onkeypress="if(event.keyCode==13) searchHeritage()">
        <button onclick="searchHeritage()">ê²€ìƒ‰</button>
    </div>

    <div id="result-area"></div>

    <script>
        // Vercel íŒŒì´ì¬ ì„œë²„ ì£¼ì†Œ (ìˆ˜ì • ë¶ˆí•„ìš”)
        const PROXY_BASE = "/api/proxy?url=";
        
        // êµ­ê°€ìœ ì‚°ì²­ API ì£¼ì†Œ
        const LIST_URL = "http://www.khs.go.kr/cha/SearchKindOpenapiList.do";
        const DETAIL_URL = "http://www.khs.go.kr/cha/SearchKindOpenapiDt.do";

        async function searchHeritage() {
            const query = document.getElementById('searchInput').value;
            const resultArea = document.getElementById('result-area');
            
            if(!query) { alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”."); return; }

            resultArea.innerHTML = '<div class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>';

            try {
                // 1. ëª©ë¡ ê²€ìƒ‰ ìš”ì²­
                const targetUrl = `${LIST_URL}?ccbaMnm1=${encodeURIComponent(query)}`;
                const response = await fetch(PROXY_BASE + encodeURIComponent(targetUrl));
                const str = await response.text();
                
                // 2. XML ë°ì´í„° ë¶„ì„ (íŒŒì‹±)
                const parser = new DOMParser();
                const xml = parser.parseFromString(str, "text/xml");
                const items = xml.getElementsByTagName("item");

                resultArea.innerHTML = ""; // ë¡œë”© ë¬¸êµ¬ ì œê±°

                if (items.length === 0) {
                    resultArea.innerHTML = "<div class='loading'>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>";
                    return;
                }

                // 3. ë¦¬ìŠ¤íŠ¸ ë§Œë“¤ê¸°
                for (let item of items) {
                    const name = item.getElementsByTagName("ccbaMnm1")[0].textContent; // ì´ë¦„
                    // ìƒì„¸ë³´ê¸°ì— í•„ìš”í•œ ì½”ë“œë“¤ ì¶”ì¶œ
                    const kdcd = item.getElementsByTagName("ccbaKdcd")[0].textContent;
                    const ctcd = item.getElementsByTagName("ccbaCtcd")[0].textContent;
                    const asno = item.getElementsByTagName("ccbaAsno")[0].textContent;

                    // í™”ë©´ì— ë°•ìŠ¤ ë§Œë“¤ê¸°
                    const div = document.createElement("div");
                    div.className = "item";
                    div.innerHTML = `
                        <div class="item-title">${name}</div>
                        <div class="item-info">ğŸ‘† ëˆŒëŸ¬ì„œ ìƒì„¸ì„¤ëª… ë³´ê¸°</div>
                        <div class="detail-view" id="detail-${kdcd}-${asno}">ë¡œë”© ì¤‘...</div>
                    `;
                    
                    // í´ë¦­í•˜ë©´ ìƒì„¸ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                    div.onclick = (e) => {
                        // ì´ë¯¸ì§€ê°€ í´ë¦­ëœ ê²Œ ì•„ë‹ˆë©´ í† ê¸€ ì‹¤í–‰
                        if(e.target.tagName !== 'IMG') {
                            toggleDetail(kdcd, ctcd, asno, div);
                        }
                    };
                    resultArea.appendChild(div);
                }

            } catch (error) {
                console.error(error);
                resultArea.innerHTML = "<div class='loading'>ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. (ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”)</div>";
            }
        }

        async function toggleDetail(kdcd, ctcd, asno, parentDiv) {
            const detailView = parentDiv.querySelector(".detail-view");
            
            // ì´ë¯¸ ì—´ë ¤ìˆìœ¼ë©´ ë‹«ê¸°
            if (detailView.style.display === "block") {
                detailView.style.display = "none";
                return;
            }
            
            detailView.style.display = "block";

            // ì´ë¯¸ ì •ë³´ë¥¼ ê°€ì ¸ì™”ë˜ ê±°ë¼ë©´ ë‹¤ì‹œ ë¡œë”©í•˜ì§€ ì•ŠìŒ
            if (detailView.getAttribute("data-loaded") === "true") return;

            try {
                // ìƒì„¸ì •ë³´ API ìš”ì²­
                const targetUrl = `${DETAIL_URL}?ccbaKdcd=${kdcd}&ccbaCtcd=${ctcd}&ccbaAsno=${asno}`;
                const response = await fetch(PROXY_BASE + encodeURIComponent(targetUrl));
                const str = await response.text();
                
                const parser = new DOMParser();
                const xml = parser.parseFromString(str, "text/xml");

                const content = xml.getElementsByTagName("content")[0]?.textContent || "ìƒì„¸ ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤.";
                const imgUrl = xml.getElementsByTagName("imageUrl")[0]?.textContent;

                let html = "";
                if (imgUrl) {
                    html += `<img src="${imgUrl}" class="detail-img" alt="ë¬¸í™”ìœ ì‚° ì´ë¯¸ì§€"><br>`;
                }
                html += `<div class="detail-desc">${content}</div>`;

                detailView.innerHTML = html;
                detailView.setAttribute("data-loaded", "true"); // ë¡œë”© ì™„ë£Œ í‘œì‹œ

            } catch (e) {
                detailView.innerHTML = "ìƒì„¸ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
            }
        }
    </script>
</body>
</html>