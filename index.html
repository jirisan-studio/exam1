<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>êµ­ê°€ìœ ì‚° ì§€ë„ ê²€ìƒ‰</title>
    
    <meta name="description" content="ìš°ë¦¬ë‚˜ë¼ êµ­ê°€ìœ ì‚°ì˜ ìœ„ì¹˜ì™€ ìƒì„¸ ì •ë³´ë¥¼ í•œëˆˆì— í™•ì¸í•˜ì„¸ìš”.">
    <meta property="og:title" content="êµ­ê°€ìœ ì‚° ì§€ë„ ê²€ìƒ‰">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <!-- ë„¤ì´ë²„ ì§€ë„ API -->
    <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=q9guv183ig"></script>
    
    <style>
        /* ê¸°ë³¸ ì„¤ì • */
        body { font-family: 'Pretendard', sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background-color: #f4f6f8; min-height: 100vh; padding-bottom: 150px; color: #333; box-sizing: border-box; }
        h1 { text-align: center; color: #2c3e50; margin-bottom: 20px; letter-spacing: -1px; cursor: pointer; }
        
        /* 3ë‹¨ íƒ­ ë””ìì¸ */
        .mode-tabs { display: flex; margin-bottom: 20px; border-bottom: 2px solid #ddd; }
        .mode-tab { flex: 1; padding: 15px 5px; text-align: center; cursor: pointer; font-weight: bold; color: #888; background: none; border: none; font-size: 1rem; transition: 0.2s; white-space: nowrap; }
        .mode-tab.active { color: #2c3e50; border-bottom: 3px solid #2c3e50; margin-bottom: -2px; }

        /* ê²€ìƒ‰ ì»¨í…Œì´ë„ˆë“¤ */
        .search-container { display: none; padding: 10px 0; }
        .search-container.active { display: block; }

        /* ì´ë¦„ ê²€ìƒ‰ì°½ */
        .search-box { display: flex; gap: 10px; margin-bottom: 10px; }
        input { flex: 1; padding: 15px; font-size: 16px; border: 1px solid #ddd; border-radius: 8px; outline: none; transition: 0.3s; }
        input:focus { border-color: #2c3e50; }
        button.search-btn { padding: 15px 20px; font-size: 16px; background-color: #2c3e50; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; white-space: nowrap; }
        
        /* ë‚´ ì£¼ë³€ ë²„íŠ¼ */
        .gps-btn { background-color: #27ae60; width: 100%; padding: 15px; border-radius: 8px; color: white; font-weight: bold; border: none; cursor: pointer; font-size: 1rem; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .gps-btn:hover { background-color: #219150; }

        /* ì§€ì—­ ì„ íƒ ì¹© (PC ì¤„ë°”ê¿ˆ ëŒ€ì‘) */
        .region-scroll-area { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; margin-bottom: 15px; }
        .chip-btn { padding: 8px 14px; border-radius: 20px; border: 1px solid #ddd; background: white; color: #555; cursor: pointer; font-size: 0.95em; transition: 0.2s; }
        .chip-btn.active { background-color: #2c3e50; color: white; border-color: #2c3e50; font-weight: bold; }

        /* í•˜ìœ„ ì§€ì—­ */
        #sub-region-area { display: none; border-top: 1px dashed #ddd; padding-top: 15px; margin-bottom: 20px; text-align: center; background-color: #eef2f5; padding: 15px; border-radius: 8px; }
        .sub-region-title { font-size: 0.9em; color: #2c3e50; margin-bottom: 10px; font-weight: bold; display: block; }

        /* âœ¨ ì•Œì•½ í•„í„° (ë³µêµ¬ë¨) */
        .filter-container { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; margin-bottom: 20px; }
        .filter-chip { 
            display: inline-flex; align-items: center; justify-content: center;
            padding: 8px 16px; font-size: 0.9rem; font-weight: 500; 
            color: #555; background-color: white; border: 1px solid #ddd; 
            border-radius: 9999px; cursor: pointer; transition: all 0.2s; 
        }
        .filter-chip:hover { background-color: #f0f0f0; }
        .filter-chip.active { background-color: #2c3e50; color: white; border-color: #2c3e50; font-weight: bold; }

        /* ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ */
        #result-area { display: flex; flex-direction: column; gap: 15px; margin-top: 20px; }
        .item { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); cursor: pointer; border: 1px solid #eee; transition: 0.2s; }
        .item:hover { transform: translateY(-3px); border-color: #2c3e50; }
        
        .item-header { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; flex-wrap: wrap; }
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 0.8em; font-weight: bold; color: white; background-color: #95a5a6; }
        .badge.êµ­ë³´ { background-color: #d35400; }
        .badge.ë³´ë¬¼ { background-color: #2980b9; }
        .badge.ì‚¬ì  { background-color: #27ae60; }
        
        .dist-badge { font-size: 0.9em; color: #e67e22; font-weight: bold; margin-left: auto; }
        
        .item-title { font-size: 1.2em; font-weight: bold; color: #333; }
        .item-info { font-size: 0.9em; color: #7f8c8d; }

        .detail-view { margin-top: 15px; padding-top: 15px; border-top: 1px dashed #eee; display: none; }
        .detail-img { max-width: 100%; border-radius: 8px; margin-top: 10px; }
        .detail-desc { line-height: 1.6; color: #444; margin-top: 10px; word-break: keep-all; }
        .map-container { width: 100%; height: 300px; border-radius: 8px; border: 1px solid #ddd; margin-top: 15px; }
        .loading { text-align: center; color: #888; padding: 30px; }

        /* âœ¨ ê´€ë ¨ ì‚¬ì´íŠ¸ ë°°ë„ˆ (ë³µêµ¬ë¨) */
        .related-section { margin-top: 40px; padding-top: 20px; border-top: 1px dashed #ddd; }
        .related-title { font-size: 0.9em; color: #888; margin-bottom: 10px; text-align: center; }
        .quick-links { display: grid; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 8px; }
        .link-card { background: white; border-radius: 8px; padding: 10px 5px; text-align: center; text-decoration: none; color: #555; font-size: 0.8em; font-weight: bold; border: 1px solid #eee; display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .link-card:hover { border-color: #2c3e50; color: #2c3e50; }

        /* âœ¨ í‘¸í„° ë° ì¹´ìš´í„° (ë³µêµ¬ë¨) */
        .footer { text-align: center; margin-top: 40px; padding-top: 20px; border-top: 1px solid #eee; color: #888; font-size: 0.85em; line-height: 1.6; }
        .contact-link { display: inline-block; margin-top: 5px; cursor: pointer; color: #555; font-weight: bold; }
        .hits-badge { margin-top: 10px; }
        .hits-badge img { height: 20px; }
    </style>
</head>
<body>

    <h1 onclick="location.reload()">ğŸ›ï¸ êµ­ê°€ìœ ì‚° ì§€ë„ ê²€ìƒ‰</h1>
    
    <!-- 3ë‹¨ íƒ­ ë©”ë‰´ -->
    <div class="mode-tabs">
        <button class="mode-tab active" onclick="switchMode('name')">ì´ë¦„ìœ¼ë¡œ ì°¾ê¸°</button>
        <button class="mode-tab" onclick="switchMode('region')">ì§€ì—­ìœ¼ë¡œ ì°¾ê¸°</button>
        <button class="mode-tab" onclick="switchMode('nearby')">ğŸ“ ë‚´ ê·¼ì²˜ ì°¾ê¸°</button>
    </div>

    <!-- 1. ì´ë¦„ ê²€ìƒ‰ -->
    <div id="search-name" class="search-container active">
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="ë¬¸í™”ìœ ì‚° ì´ë¦„ (ì˜ˆ: ìˆ­ë¡€ë¬¸, ë¶ˆêµ­ì‚¬)" onkeypress="if(event.keyCode==13) searchHeritage()">
            <button class="search-btn" onclick="searchHeritage()">ê²€ìƒ‰</button>
        </div>
    </div>

    <!-- 2. ì§€ì—­ ê²€ìƒ‰ -->
    <div id="search-region" class="search-container">
        <div id="region-main-scroll" class="region-scroll-area"></div>
        <div id="sub-region-area">
            <span class="sub-region-title">â–¼ ìƒì„¸ ì§€ì—­ ì„ íƒ</span>
            <div id="region-sub-scroll" class="region-scroll-area"></div>
        </div>
    </div>

    <!-- 3. ë‚´ ê·¼ì²˜ ì°¾ê¸° -->
    <div id="search-nearby" class="search-container">
        <p style="text-align:center; color:#666; margin-bottom:15px; font-size:0.9em;">
            í˜„ì¬ ìœ„ì¹˜ë¥¼ í™•ì¸í•˜ì—¬ ê°€ê¹Œìš´ ìˆœì„œëŒ€ë¡œ ì •ë ¬í•©ë‹ˆë‹¤.
        </p>
        <button onclick="sortByLocation()" class="gps-btn" id="gpsBtn">
            ğŸ“¡ ë‚´ ìœ„ì¹˜ í™•ì¸í•˜ê³  ê²€ìƒ‰í•˜ê¸°
        </button>
    </div>

    <!-- âœ¨ í•„í„° íƒ­ (ì•Œì•½ ëª¨ì–‘ ë³µêµ¬) -->
    <div id="filter-area" class="filter-container"></div>

    <div id="result-area"></div>

    <!-- âœ¨ ê´€ë ¨ ì‚¬ì´íŠ¸ ë°°ë„ˆ ë³µêµ¬ -->
    <div class="related-section">
        <h3 class="related-title">ê´€ë ¨ ì‚¬ì´íŠ¸</h3>
        <div class="quick-links">
            <a href="https://www.khs.go.kr" target="_blank" class="link-card"><span>ğŸ›ï¸</span><span>êµ­ê°€ìœ ì‚°ì²­</span></a>
            <a href="https://www.heritage.go.kr" target="_blank" class="link-card"><span>ğŸŒ</span><span>êµ­ê°€ìœ ì‚°í¬í„¸</span></a>
            <a href="https://www.museum.go.kr" target="_blank" class="link-card"><span>ğŸº</span><span>êµ­ë¦½ì¤‘ì•™ë°•ë¬¼ê´€</span></a>
            <a href="https://korean.visitkorea.or.kr" target="_blank" class="link-card"><span>âœˆï¸</span><span>êµ¬ì„êµ¬ì„</span></a>
        </div>
    </div>

    <!-- âœ¨ í‘¸í„° ë³µêµ¬ -->
    <div class="footer">
        - Made by ì´íƒœê±´ -<br>
        <span class="contact-link" onclick="copyEmail()">ğŸ“© ë¬¸ì˜í•˜ê¸° (Contact)</span><br>
        <div class="hits-badge">
            <img src="https://api.visitorbadge.io/api/visitors?path=https%3A%2F%2Fheritagekorea.vercel.app&countColor=%232C3E50&style=flat" />
        </div>
    </div>

    <script>
        const PROXY_BASE = "/api/proxy?url=";
        const LIST_URL = "http://www.khs.go.kr/cha/SearchKindOpenapiList.do";
        const DETAIL_URL = "http://www.khs.go.kr/cha/SearchKindOpenapiDt.do";
        const MY_EMAIL = "naturekr@gmail.com";

        let currentItems = [];
        let currentState = { query: "", regionCode: "", subRegionCode: "", kdcd: "" };

        // ì§€ì—­ ë°ì´í„° (ë‚´ì¥)
        const REGIONS = [
            { code: "11", name: "ì„œìš¸" }, { code: "21", name: "ë¶€ì‚°" }, { code: "22", name: "ëŒ€êµ¬" },
            { code: "23", name: "ì¸ì²œ" }, { code: "24", name: "ê´‘ì£¼" }, { code: "25", name: "ëŒ€ì „" },
            { code: "26", name: "ìš¸ì‚°" }, { code: "45", name: "ì„¸ì¢…" }, { code: "31", name: "ê²½ê¸°" },
            { code: "32", name: "ê°•ì›" }, { code: "33", name: "ì¶©ë¶" }, { code: "34", name: "ì¶©ë‚¨" },
            { code: "35", name: "ì „ë¶" }, { code: "36", name: "ì „ë‚¨" }, { code: "37", name: "ê²½ë¶" },
            { code: "38", name: "ê²½ë‚¨" }, { code: "50", name: "ì œì£¼" }
        ];

        const SUB_REGIONS = {
            "11": [{code:"11",name:"ì¢…ë¡œêµ¬"},{code:"12",name:"ì¤‘êµ¬"},{code:"13",name:"ìš©ì‚°êµ¬"},{code:"14",name:"ì„±ë™êµ¬"},{code:"15",name:"ë™ëŒ€ë¬¸êµ¬"},{code:"16",name:"ì„±ë¶êµ¬"},{code:"17",name:"ë„ë´‰êµ¬"},{code:"18",name:"ì€í‰êµ¬"},{code:"19",name:"ì„œëŒ€ë¬¸êµ¬"},{code:"20",name:"ë§ˆí¬êµ¬"},{code:"21",name:"ê°•ì„œêµ¬"},{code:"22",name:"êµ¬ë¡œêµ¬"},{code:"23",name:"ì˜ë“±í¬êµ¬"},{code:"24",name:"ë™ì‘êµ¬"},{code:"25",name:"ê´€ì•…êµ¬"},{code:"26",name:"ê°•ë‚¨êµ¬"},{code:"27",name:"ê°•ë™êµ¬"},{code:"28",name:"ì†¡íŒŒêµ¬"},{code:"29",name:"ì¤‘ë‘êµ¬"},{code:"30",name:"ë…¸ì›êµ¬"},{code:"31",name:"ì„œì´ˆêµ¬"},{code:"32",name:"ì–‘ì²œêµ¬"},{code:"33",name:"ê´‘ì§„êµ¬"},{code:"34",name:"ê°•ë¶êµ¬"},{code:"35",name:"ê¸ˆì²œêµ¬"}],
            "21": [{code:"11",name:"ì¤‘êµ¬"},{code:"12",name:"ì„œêµ¬"},{code:"13",name:"ë™êµ¬"},{code:"14",name:"ì˜ë„êµ¬"},{code:"15",name:"ë¶€ì‚°ì§„êµ¬"},{code:"16",name:"ë™ë˜êµ¬"},{code:"17",name:"ë‚¨êµ¬"},{code:"18",name:"ë¶êµ¬"},{code:"19",name:"í•´ìš´ëŒ€êµ¬"},{code:"20",name:"ì‚¬í•˜êµ¬"},{code:"21",name:"ê¸ˆì •êµ¬"},{code:"22",name:"ê°•ì„œêµ¬"},{code:"23",name:"ì—°ì œêµ¬"},{code:"24",name:"ìˆ˜ì˜êµ¬"},{code:"25",name:"ì‚¬ìƒêµ¬"},{code:"26",name:"ê¸°ì¥êµ°"}],
            "22": [{code:"11",name:"ì¤‘êµ¬"},{code:"12",name:"ë™êµ¬"},{code:"13",name:"ì„œêµ¬"},{code:"14",name:"ë‚¨êµ¬"},{code:"15",name:"ë¶êµ¬"},{code:"16",name:"ìˆ˜ì„±êµ¬"},{code:"17",name:"ë‹¬ì„œêµ¬"},{code:"31",name:"ë‹¬ì„±êµ°"},{code:"32",name:"êµ°ìœ„êµ°"}],
            "23": [{code:"11",name:"ì¤‘êµ¬"},{code:"12",name:"ë™êµ¬"},{code:"20",name:"ë¯¸ì¶”í™€êµ¬"},{code:"15",name:"ì„œêµ¬"},{code:"16",name:"ë‚¨ë™êµ¬"},{code:"17",name:"ì—°ìˆ˜êµ¬"},{code:"18",name:"ë¶€í‰êµ¬"},{code:"19",name:"ê³„ì–‘êµ¬"},{code:"30",name:"ê°•í™”êµ°"},{code:"31",name:"ì˜¹ì§„êµ°"}],
            "24": [{code:"11",name:"ë™êµ¬"},{code:"12",name:"ì„œêµ¬"},{code:"13",name:"ë¶êµ¬"},{code:"14",name:"ê´‘ì‚°êµ¬"},{code:"15",name:"ë‚¨êµ¬"}],
            "25": [{code:"11",name:"ë™êµ¬"},{code:"12",name:"ì¤‘êµ¬"},{code:"13",name:"ì„œêµ¬"},{code:"14",name:"ìœ ì„±êµ¬"},{code:"15",name:"ëŒ€ë•êµ¬"}],
            "26": [{code:"01",name:"ë‚¨êµ¬"},{code:"02",name:"ë™êµ¬"},{code:"03",name:"ë¶êµ¬"},{code:"04",name:"ì¤‘êµ¬"},{code:"05",name:"ìš¸ì£¼êµ°"}],
            "45": [],
            "31": [{code:"11",name:"ìˆ˜ì›ì‹œ"},{code:"12",name:"ì„±ë‚¨ì‹œ"},{code:"13",name:"ì˜ì •ë¶€ì‹œ"},{code:"14",name:"ì•ˆì–‘ì‹œ"},{code:"15",name:"ë¶€ì²œì‹œ"},{code:"16",name:"ê´‘ëª…ì‹œ"},{code:"17",name:"ì•ˆì„±ì‹œ"},{code:"18",name:"ë™ë‘ì²œì‹œ"},{code:"19",name:"êµ¬ë¦¬ì‹œ"},{code:"20",name:"í‰íƒì‹œ"},{code:"21",name:"ê³¼ì²œì‹œ"},{code:"22",name:"ì•ˆì‚°ì‹œ"},{code:"25",name:"ì˜¤ì‚°ì‹œ"},{code:"26",name:"ì˜ì™•ì‹œ"},{code:"27",name:"êµ°í¬ì‹œ"},{code:"28",name:"ì‹œí¥ì‹œ"},{code:"30",name:"í•˜ë‚¨ì‹œ"},{code:"31",name:"ì–‘ì£¼ì‹œ"},{code:"70",name:"ì—¬ì£¼ì‹œ"},{code:"35",name:"í™”ì„±ì‹œ"},{code:"37",name:"íŒŒì£¼ì‹œ"},{code:"39",name:"ê´‘ì£¼ì‹œ"},{code:"40",name:"ì—°ì²œêµ°"},{code:"41",name:"í¬ì²œì‹œ"},{code:"42",name:"ê°€í‰êµ°"},{code:"43",name:"ì–‘í‰êµ°"},{code:"44",name:"ì´ì²œì‹œ"},{code:"45",name:"ìš©ì¸ì‹œ"},{code:"47",name:"ê¹€í¬ì‹œ"},{code:"50",name:"ê³ ì–‘ì‹œ"},{code:"51",name:"ë‚¨ì–‘ì£¼ì‹œ"}],
            "32": [{code:"11",name:"ì¶˜ì²œì‹œ"},{code:"12",name:"ì›ì£¼ì‹œ"},{code:"13",name:"ê°•ë¦‰ì‹œ"},{code:"14",name:"ë™í•´ì‹œ"},{code:"15",name:"íƒœë°±ì‹œ"},{code:"16",name:"ì†ì´ˆì‹œ"},{code:"17",name:"ì‚¼ì²™ì‹œ"},{code:"32",name:"í™ì²œêµ°"},{code:"33",name:"íš¡ì„±êµ°"},{code:"35",name:"ì˜ì›”êµ°"},{code:"36",name:"í‰ì°½êµ°"},{code:"37",name:"ì •ì„ êµ°"},{code:"38",name:"ì² ì›êµ°"},{code:"39",name:"í™”ì²œêµ°"},{code:"40",name:"ì–‘êµ¬êµ°"},{code:"41",name:"ì¸ì œêµ°"},{code:"42",name:"ê³ ì„±êµ°"},{code:"43",name:"ì–‘ì–‘êµ°"}],
            "33": [{code:"20",name:"ì²­ì£¼ì‹œ"},{code:"12",name:"ì¶©ì£¼ì‹œ"},{code:"13",name:"ì œì²œì‹œ"},{code:"32",name:"ë³´ì€êµ°"},{code:"33",name:"ì˜¥ì²œêµ°"},{code:"34",name:"ì˜ë™êµ°"},{code:"35",name:"ì§„ì²œêµ°"},{code:"36",name:"ê´´ì‚°êµ°"},{code:"37",name:"ìŒì„±êµ°"},{code:"40",name:"ë‹¨ì–‘êµ°"},{code:"42",name:"ì¦í‰êµ°"}],
            "34": [{code:"11",name:"ì²œì•ˆì‹œ"},{code:"12",name:"ê³µì£¼ì‹œ"},{code:"15",name:"ì„œì‚°ì‹œ"},{code:"16",name:"ì•„ì‚°ì‹œ"},{code:"17",name:"ë³´ë ¹ì‹œ"},{code:"18",name:"ê³„ë£¡ì‹œ"},{code:"31",name:"ê¸ˆì‚°êµ°"},{code:"35",name:"ë…¼ì‚°ì‹œ"},{code:"36",name:"ë¶€ì—¬êµ°"},{code:"37",name:"ì„œì²œêµ°"},{code:"39",name:"ì²­ì–‘êµ°"},{code:"40",name:"í™ì„±êµ°"},{code:"41",name:"ì˜ˆì‚°êµ°"},{code:"43",name:"ë‹¹ì§„ì‹œ"},{code:"46",name:"íƒœì•ˆêµ°"}],
            "35": [{code:"11",name:"ì „ì£¼ì‹œ"},{code:"12",name:"êµ°ì‚°ì‹œ"},{code:"15",name:"ë‚¨ì›ì‹œ"},{code:"16",name:"ê¹€ì œì‹œ"},{code:"17",name:"ì •ìì‹œ"},{code:"18",name:"ìµì‚°ì‹œ"},{code:"31",name:"ì™„ì£¼êµ°"},{code:"32",name:"ì§„ì•ˆêµ°"},{code:"33",name:"ë¬´ì£¼êµ°"},{code:"34",name:"ì¥ìˆ˜êµ°"},{code:"35",name:"ì„ì‹¤êµ°"},{code:"37",name:"ìˆœì°½êµ°"},{code:"39",name:"ê³ ì°½êµ°"},{code:"40",name:"ë¶€ì•ˆêµ°"}],
            "36": [{code:"11",name:"ëª©í¬ì‹œ"},{code:"12",name:"ì—¬ìˆ˜ì‹œ"},{code:"13",name:"ìˆœì²œì‹œ"},{code:"14",name:"ë‚˜ì£¼ì‹œ"},{code:"17",name:"ê´‘ì–‘ì‹œ"},{code:"32",name:"ë‹´ì–‘êµ°"},{code:"33",name:"ê³¡ì„±êµ°"},{code:"34",name:"êµ¬ë¡€êµ°"},{code:"38",name:"ê³ í¥êµ°"},{code:"39",name:"ë³´ì„±êµ°"},{code:"40",name:"í™”ìˆœêµ°"},{code:"41",name:"ì¥í¥êµ°"},{code:"42",name:"ê°•ì§„êµ°"},{code:"43",name:"í•´ë‚¨êµ°"},{code:"44",name:"ì˜ì•”êµ°"},{code:"45",name:"ë¬´ì•ˆêµ°"},{code:"47",name:"í•¨í‰êµ°"},{code:"48",name:"ì˜ê´‘êµ°"},{code:"49",name:"ì¥ì„±êµ°"},{code:"50",name:"ì™„ë„êµ°"},{code:"51",name:"ì§„ë„êµ°"},{code:"52",name:"ì‹ ì•ˆêµ°"}],
            "37": [{code:"11",name:"í¬í•­ì‹œ"},{code:"12",name:"ê²½ì£¼ì‹œ"},{code:"13",name:"ê¹€ì²œì‹œ"},{code:"14",name:"ì•ˆë™ì‹œ"},{code:"15",name:"êµ¬ë¯¸ì‹œ"},{code:"16",name:"ì˜ì£¼ì‹œ"},{code:"17",name:"ì˜ì²œì‹œ"},{code:"18",name:"ìƒì£¼ì‹œ"},{code:"20",name:"ê²½ì‚°ì‹œ"},{code:"21",name:"ë¬¸ê²½ì‹œ"},{code:"33",name:"ì˜ì„±êµ°"},{code:"35",name:"ì²­ì†¡êµ°"},{code:"36",name:"ì˜ì–‘êµ°"},{code:"37",name:"ì˜ë•êµ°"},{code:"42",name:"ì²­ë„êµ°"},{code:"43",name:"ê³ ë ¹êµ°"},{code:"44",name:"ì„±ì£¼êµ°"},{code:"45",name:"ì¹ ê³¡êµ°"},{code:"50",name:"ì˜ˆì²œêµ°"},{code:"52",name:"ë´‰í™”êµ°"},{code:"53",name:"ìš¸ì§„êµ°"},{code:"54",name:"ìš¸ë¦‰êµ°"}],
            "38": [{code:"13",name:"ì§„ì£¼ì‹œ"},{code:"50",name:"ì°½ì›ì‹œ"},{code:"18",name:"ê¹€í•´ì‹œ"},{code:"22",name:"ë°€ì–‘ì‹œ"},{code:"25",name:"í†µì˜ì‹œ"},{code:"26",name:"ê±°ì œì‹œ"},{code:"27",name:"ì‚¬ì²œì‹œ"},{code:"32",name:"ì˜ë ¹êµ°"},{code:"33",name:"í•¨ì•ˆêµ°"},{code:"34",name:"ì°½ë…•êµ°"},{code:"36",name:"ì–‘ì‚°ì‹œ"},{code:"39",name:"ì˜ì°½êµ°"},{code:"42",name:"ê³ ì„±êµ°"},{code:"44",name:"ë‚¨í•´êµ°"},{code:"45",name:"í•˜ë™êµ°"},{code:"46",name:"ì‚°ì²­êµ°"},{code:"47",name:"í•¨ì–‘êµ°"},{code:"48",name:"ê±°ì°½êµ°"},{code:"49",name:"í•©ì²œêµ°"}],
            "50": [{code:"01",name:"ì œì£¼ì‹œ"},{code:"02",name:"ì„œê·€í¬ì‹œ"}]
        };

        const CATEGORIES = [
            { code: "", name: "ì „ì²´" }, { code: "11", name: "êµ­ë³´" }, { code: "12", name: "ë³´ë¬¼" },
            { code: "13", name: "ì‚¬ì " }, { code: "14", name: "ì‚¬ì ë°ëª…ìŠ¹" }, { code: "15", name: "ëª…ìŠ¹" },
            { code: "16", name: "ì²œì—°ê¸°ë…ë¬¼" }, { code: "17", name: "êµ­ê°€ë¯¼ì†" }, { code: "18", name: "êµ­ê°€ë¬´í˜•" },
            { code: "79", name: "êµ­ê°€ë“±ë¡" }, { code: "21", name: "ì‹œë„ìœ í˜•" }, { code: "22", name: "ì‹œë„ë¬´í˜•" },
            { code: "23", name: "ì‹œë„ê¸°ë…ë¬¼" }, { code: "24", name: "ì‹œë„ë¯¼ì†" }, { code: "25", name: "ì‹œë„ë“±ë¡" },
            { code: "31", name: "ë¬¸í™”ìœ ì‚°ìë£Œ" }, { code: "80", name: "ì´ë¶5ë„" }
        ];

        window.onload = function() {
            renderRegionGrid();
            createFilterTabs(""); 
        };

        function copyEmail() {
            navigator.clipboard.writeText(MY_EMAIL).then(() => {
                alert(`ğŸ“§ ì´ë©”ì¼ ì£¼ì†Œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\n(${MY_EMAIL})`);
            });
        }

        function switchMode(mode) {
            currentState.mode = mode;
            document.querySelectorAll('.mode-tab').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.search-container').forEach(c => c.classList.remove('active'));
            
            if(mode === 'name') {
                document.querySelectorAll('.mode-tab')[0].classList.add('active');
                document.getElementById('search-name').classList.add('active');
            } else if(mode === 'region') {
                document.querySelectorAll('.mode-tab')[1].classList.add('active');
                document.getElementById('search-region').classList.add('active');
            } else if(mode === 'nearby') {
                document.querySelectorAll('.mode-tab')[2].classList.add('active');
                document.getElementById('search-nearby').classList.add('active');
            }
            
            document.getElementById('result-area').innerHTML = "";
            document.getElementById('filter-area').innerHTML = "";
            document.getElementById('sub-region-area').style.display = 'none';
            document.querySelectorAll('.chip-btn').forEach(b => b.classList.remove('active'));
        }

        function renderRegionGrid() {
            const grid = document.getElementById('region-main-scroll');
            let html = "";
            REGIONS.forEach(r => {
                html += `<button class="chip-btn" onclick="selectMainRegion('${r.code}', this)">${r.name}</button>`;
            });
            grid.innerHTML = html;
        }

        function selectMainRegion(code, btn) {
            document.getElementById('region-main-scroll').querySelectorAll('.chip-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            currentState.regionCode = code;
            currentState.subRegionCode = "";
            currentState.query = ""; // ì§€ì—­ ê²€ìƒ‰ ì‹œ ê²€ìƒ‰ì–´ ì´ˆê¸°í™”
            
            renderSubRegions(code);
            searchHeritage(); // ì „ì²´ ê²€ìƒ‰
        }

        function renderSubRegions(mainCode) {
            const subArea = document.getElementById('sub-region-area');
            const subScroll = document.getElementById('region-sub-scroll');
            const subList = SUB_REGIONS[mainCode];

            if (!subList || subList.length === 0) {
                subArea.style.display = 'none';
                return;
            }

            subArea.style.display = 'block';
            let html = `<button class="chip-btn active" onclick="selectSubRegion('', '${mainCode}', this)">ì „ì²´</button>`;
            subList.forEach(sub => {
                html += `<button class="chip-btn" onclick="selectSubRegion('${sub.code}', '${mainCode}', this)">${sub.name}</button>`;
            });
            subScroll.innerHTML = html;
        }

        function selectSubRegion(subCode, mainCode, btn) {
            document.getElementById('region-sub-scroll').querySelectorAll('.chip-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            currentState.subRegionCode = subCode;
            searchHeritage();
        }

        async function searchByName() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) { alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”."); return; }
            currentState = { mode: 'name', query: query, regionCode: "", subRegionCode: "", kdcd: "" };
            searchHeritage();
        }

        async function searchHeritage() {
            const resultArea = document.getElementById('result-area');
            resultArea.innerHTML = '<div class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>';
            
            let targetUrl = `${LIST_URL}?pageUnit=50`;
            if (currentState.query) targetUrl += `&ccbaMnm1=${encodeURIComponent(currentState.query)}`;
            if (currentState.regionCode) targetUrl += `&ccbaCtcd=${currentState.regionCode}`;
            if (currentState.subRegionCode) targetUrl += `&ccbaLcto=${currentState.subRegionCode}`;
            if (currentState.kdcd) targetUrl += `&ccbaKdcd=${currentState.kdcd}`;

            try {
                const response = await fetch(PROXY_BASE + encodeURIComponent(targetUrl));
                const str = await response.text();
                const parser = new DOMParser();
                const xml = parser.parseFromString(str, "text/xml");
                const items = xml.getElementsByTagName("item");

                currentItems = [];
                for (let item of items) {
                    currentItems.push({
                        name: item.getElementsByTagName("ccbaMnm1")[0].textContent,
                        type: item.getElementsByTagName("ccmaName")[0].textContent,
                        kdcd: item.getElementsByTagName("ccbaKdcd")[0].textContent,
                        ctcd: item.getElementsByTagName("ccbaCtcd")[0].textContent,
                        asno: item.getElementsByTagName("ccbaAsno")[0].textContent,
                        lat: parseFloat(item.getElementsByTagName("latitude")[0]?.textContent || 0),
                        lng: parseFloat(item.getElementsByTagName("longitude")[0]?.textContent || 0),
                        distance: null
                    });
                }
                renderList(currentItems);
                
                // âœ¨ ë¹„ë™ê¸° ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸ (ì†ë„ ì €í•˜ ë°©ì§€)
                updateFilterCounts();

            } catch (error) {
                console.error(error);
                resultArea.innerHTML = "<div class='loading'>ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>";
            }
        }

        async function updateFilterCounts() {
            const filterArea = document.getElementById('filter-area');
            filterArea.innerHTML = `<button class="filter-chip active">ì „ì²´ ë¡œë”©ì¤‘...</button>`; 

            const promises = CATEGORIES.map(async (cat) => {
                let url = `${LIST_URL}?pageUnit=1&ccbaKdcd=${cat.code}`;
                if (currentState.query) url += `&ccbaMnm1=${encodeURIComponent(currentState.query)}`;
                if (currentState.regionCode) url += `&ccbaCtcd=${currentState.regionCode}`;
                if (currentState.subRegionCode) url += `&ccbaLcto=${currentState.subRegionCode}`;

                try {
                    const res = await fetch(PROXY_BASE + encodeURIComponent(url));
                    const str = await res.text();
                    const xml = new DOMParser().parseFromString(str, "text/xml");
                    const totalCnt = xml.getElementsByTagName("totalCnt")[0]?.textContent || "0";
                    return { ...cat, count: parseInt(totalCnt) };
                } catch { return { ...cat, count: 0 }; }
            });

            const results = await Promise.all(promises);
            
            let html = "";
            results.forEach((item) => {
                if (item.count > 0) {
                    const activeClass = (currentState.kdcd === item.code) ? "active" : "";
                    let displayName = item.name.replace("ë¬¸í™”ìœ ì‚°", "").replace("ìœ ì‚°", ""); 
                    if(item.name === "ì „ì²´") displayName = "ì „ì²´";
                    
                    html += `<button class="filter-chip ${activeClass}" onclick="applyFilter('${item.code}')">${displayName} (${item.count})</button>`;
                }
            });
            filterArea.innerHTML = html;
        }

        function applyFilter(kdcd) {
            currentState.kdcd = kdcd;
            searchHeritage();
        }

        function renderList(items) {
            const resultArea = document.getElementById('result-area');
            if (items.length === 0) {
                resultArea.innerHTML = "<div class='loading'>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>";
                return;
            }
            resultArea.innerHTML = "";

            items.forEach(data => {
                const div = document.createElement("div");
                div.className = "item";
                const distHtml = data.distance ? `<span class="dist-badge">ğŸ“ ${data.distance.toFixed(1)}km</span>` : "";

                div.innerHTML = `
                    <div class="item-header">
                        <span class="badge ${data.type.split(' ')[0]}">${data.type}</span>
                        <span class="item-title">${data.name}</span>
                        ${distHtml}
                    </div>
                    <div class="item-info">ğŸ“ ëˆŒëŸ¬ì„œ ì§€ë„ì™€ ìƒì„¸ì„¤ëª… ë³´ê¸°</div>
                    <div class="detail-view" id="detail-${data.kdcd}-${data.asno}">ë¡œë”© ì¤‘...</div>
                `;
                
                div.onclick = (e) => {
                    if(!e.target.closest('.detail-view')) {
                        toggleDetail(data.kdcd, data.ctcd, data.asno, div);
                    }
                };
                resultArea.appendChild(div);
            });
        }

        // ë‚´ ì£¼ë³€ ì°¾ê¸°
        function sortByLocation() {
            const btn = document.getElementById('gpsBtn');
            btn.innerText = "ğŸ“¡ ìœ„ì¹˜ í™•ì¸ ì¤‘...";

            if (!navigator.geolocation) { alert("ìœ„ì¹˜ ì •ë³´ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."); return; }

            navigator.geolocation.getCurrentPosition((position) => {
                const myLat = position.coords.latitude;
                const myLng = position.coords.longitude;

                if (currentItems.length === 0) {
                    currentState = { mode: 'nearby', query: "", regionCode: "", subRegionCode: "", kdcd: "" };
                    searchHeritage().then(() => doSort(myLat, myLng));
                } else {
                    doSort(myLat, myLng);
                }
                btn.innerText = "âœ… ê±°ë¦¬ìˆœ ì •ë ¬ ì™„ë£Œ";
            });
        }

        function doSort(myLat, myLng) {
            currentItems.forEach(item => {
                if (item.lat && item.lng && item.lat !== 0) {
                    item.distance = getDistance(myLat, myLng, item.lat, item.lng);
                } else {
                    item.distance = 99999;
                }
            });
            currentItems.sort((a, b) => a.distance - b.distance);
            renderList(currentItems);
        }

        function getDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; 
            const dLat = deg2rad(lat2 - lat1);
            const dLon = deg2rad(lon2 - lon1);
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * Math.sin(dLon/2) * Math.sin(dLon/2); 
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
            return R * c;
        }
        function deg2rad(deg) { return deg * (Math.PI/180); }

        async function toggleDetail(kdcd, ctcd, asno, parentDiv) {
            const detailView = parentDiv.querySelector(".detail-view");
            if (detailView.style.display === "block") { detailView.style.display = "none"; return; }
            detailView.style.display = "block";
            if (detailView.getAttribute("data-loaded") === "true") return;

            try {
                const targetUrl = `${DETAIL_URL}?ccbaKdcd=${kdcd}&ccbaCtcd=${ctcd}&ccbaAsno=${asno}`;
                const response = await fetch(PROXY_BASE + encodeURIComponent(targetUrl));
                const str = await response.text();
                const parser = new DOMParser();
                const xml = parser.parseFromString(str, "text/xml");

                const content = xml.getElementsByTagName("content")[0]?.textContent || "ì„¤ëª… ì—†ìŒ";
                const imgUrl = xml.getElementsByTagName("imageUrl")[0]?.textContent;
                const lat = xml.getElementsByTagName("latitude")[0]?.textContent;
                const lng = xml.getElementsByTagName("longitude")[0]?.textContent;

                let html = "";
                if (imgUrl) html += `<img src="${PROXY_BASE + encodeURIComponent(imgUrl)}" class="detail-img"><br>`;
                html += `<div class="detail-desc">${content}</div>`;

                const mapId = `map-${kdcd}-${asno}`;
                if (lat && lng && lat != "0") html += `<div id="${mapId}" class="map-container"></div>`;

                detailView.innerHTML = html;
                detailView.setAttribute("data-loaded", "true");

                if (lat && lng && lat != "0") drawNaverMap(mapId, parseFloat(lat), parseFloat(lng));

            } catch (e) { detailView.innerHTML = "ìƒì„¸ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."; }
        }

        function drawNaverMap(elementId, lat, lng) {
            if (typeof naver === "undefined") return;
            const map = new naver.maps.Map(elementId, { center: new naver.maps.LatLng(lat, lng), zoom: 16 });
            new naver.maps.Marker({ position: new naver.maps.LatLng(lat, lng), map: map });
        }
    </script>
</body>
</html>